
![Logo](https://user-images.githubusercontent.com/102625628/216847397-6f4bc3e4-d222-433c-bd95-065190160718.png#gh-dark-mode-only)

# Documentação do Projeto ArduWindow
> **Warning**: Documentação em desenvolvimento

### Visão geral do projeto ArduWindow
O ArduWindow é um projeto open-source que utiliza um ESP8266 conectado à rede wifi de casa através da IoT Arduino Cloud, para controlar um servo motor com base em um sensor de chuva ou com base nos comandos fornecidos pelo usuário para fechar ou abrir uma janela automaticamente.

O dashboard da `Arduino IoT Cloud` permite aos usuários monitorar o status do sensor, verificar se está chovendo, se a janela está fechada e controlar o servo motor remotamente (Através de computadores, celulares e outros dispositivos compatíveis com a plataforma). Este projeto é útil para automatizar a abertura e fechamento de janelas em resposta às condições climáticas, proporcionando conforto, facilidade e economia de energia.

### Guia de instalação

- Conecte o ESP8266 a um computador e abra o IDE do Arduino IoT Cloud.
- Configure o IDE para se comunicar com o ESP8266. Para isso, siga as instruções fornecidas na [documentação da IDE](https://docs.arduino.cc/arduino-cloud/).
- Após a criação de um dispositivo (conexão entre o ESP8266 e a IDE), crie um `Thing` na plataforma para criação das variáveis. Para isso, siga os seguintes passos:
    - Acesse a aba `Things` e clique em `Create`
    - Adicione as seguintes variáveis:
      - `btnServo` é responsável pelo controle do servo motor.
        - ![btnServo](https://user-images.githubusercontent.com/102625628/219237918-a5ec72bb-cc96-4a70-9608-313a7b813a38.png)
      - `chovendo` é responsável por mostrar na tela se está ou não chovendo.
        - ![chovendo](https://user-images.githubusercontent.com/102625628/219238048-7914ef70-f06c-4a6d-8c42-f292e64ba317.png)
      - `comando` é responsável por permitir a interação do usuário através do console de comandos.
        - ![comando](https://user-images.githubusercontent.com/102625628/219238071-fd5986ab-db8f-4dfc-a0c7-61407c057f6b.png)
      - `dadosGrafico` é responsável por mostrar num gráfico o status do sensor de chuva.
        - ![dadosGrafico](https://user-images.githubusercontent.com/102625628/219238083-9007f9df-2151-4e2b-97fb-c8339e7b5b6b.png)
      - `statusJanela` é responsável por mostrar na tela se a janela está aberta ou fechada.
        - ![statusJanela](https://user-images.githubusercontent.com/102625628/219238088-3f554f5d-2b7e-408f-9361-5a5f49e4f1d8.png)

- Baixe o código fonte do projeto ArduWindow do repositório GitHub.
- Abra o código no Web Editor da IDE. Insira suas credenciais de rede wifi e IoT Arduino Cloud no código da aba `thingProperties.md` e coloque o código fonte do projeto na aba principal.
- Faça upload do código para o ESP8266.

### Arquitetura do projeto
O projeto ArduWindow consiste em um ESP8266, um sensor de chuva, uma placa de controle, um servo motor e um dashboard IoT. O sensor de chuva detecta a presença de água e envia um sinal para o ESP8266. O ESP8266, conectado à rede wifi, fecha a janela automaticamente e envia o status do sensor para a IoT Arduino Cloud, alterando os valores das variáveis. O dashboard IoT exibe o status do sensor e permite ao usuário controlar o servo motor, que é conectado ao ESP8266.

### Guia de uso:
- Abra o dashboard IoT no seu navegador.
- Monitore o status do sensor de chuva na tela do dashboard.
- Mude o botão switch para "Abrir" no dashboard para abrir a janela, caso esteja fechada.
- Mude o botão switch para "Fechar" no dashboard para fechar a janela, caso esteja aberta.
- O servo motor será controlado automaticamente com base no status do sensor.

### Exemplo de código

```ino
/* 
  Sketch generated by the Arduino IoT Cloud Thing "Untitled"
  https://create.arduino.cc/cloud/things/6ea33e03-e853-4af0-b613-43d38857ed6e 

  Arduino IoT Cloud Variables description

  The following variables are automatically generated and updated when changes are made to the Thing

  String comando;
  int dadosGrafico;
  bool btnServo;
  bool chovendo;
  bool statusJanela;

  Variables which are marked as READ/WRITE in the Cloud Thing will also have functions
  which are called when their values are changed from the Dashboard.
  These functions are generated with the Thing and added at the end of this sketch.
*/

#include "thingProperties.h"
#include <Servo.h>
#define PINO_SERVO D5
#define PINO_SENSOR D7
Servo servo;

void setup() {
  pinMode(PINO_SENSOR, INPUT);
  servo.attach(PINO_SERVO);
  servo.write(0);
  Serial.begin(9600);

  // Defined in thingProperties.h
  initProperties();

  // Connect to Arduino IoT Cloud
  ArduinoCloud.begin(ArduinoIoTPreferredConnection);
  
  /*
     The following function allows you to obtain more information
     related to the state of network and IoT Cloud connection and errors
     the higher number the more granular information you’ll get.
     The default is 0 (only errors).
     Maximum is 4
 */
  setDebugMessageLevel(2);
  ArduinoCloud.printDebugInfo();
}

void loop() {
  ArduinoCloud.update();
  if (digitalRead(PINO_SENSOR) == LOW) {
    chovendo = true;
    fecharJanela();
  } else {
    chovendo = false;
  }
  dadosGrafico = analogRead(PINO_SENSOR);
}

/*
  Since Chovendo is READ_WRITE variable, onChovendoChange() is
  executed every time a new value is received from IoT Cloud.
*/
void onChovendoChange()  {
  if(chovendo == true){
    fecharJanela();
  }
}

/*
  Since BtnServo is READ_WRITE variable, onBtnServoChange() is
  executed every time a new value is received from IoT Cloud.
*/
void onBtnServoChange()  {
  if(btnServo == true){
    fecharJanela();
  } else {
    abrirJanela();
  }
}

void abrirJanela(){
  servo.write(0);
  statusJanela = false;
}

void fecharJanela(){
  servo.write(180);
  statusJanela = true;
} 

/*
  Since Comando is READ_WRITE variable, onComandoChange() is
  executed every time a new value is received from IoT Cloud.
*/
void onComandoChange()  {
  Serial.println("Insira seu comando: 'Fechar' ou 'Abrir'");
  if (comando == "Abrir" || comando == "abrir" || comando == "ABRIR") {
    abrirJanela();
  } else if (comando == "Fechar" || comando == "fechar" || comando == "FECHAR") {
      fecharJanela();
  }
}

/*
  Since DadosGrafico is READ_WRITE variable, onDadosGraficoChange() is
  executed every time a new value is received from IoT Cloud.
*/
void onDadosGraficoChange()  {
  // Add your code here to act upon DadosGrafico change
}

/*
  Since StatusJanela is READ_WRITE variable, onStatusJanelaChange() is
  executed every time a new value is received from IoT Cloud.
*/
void onStatusJanelaChange()  {
  // Add your code here to act upon StatusJanela change
}
```

### Diagrama de arquitetura
```
  +-------------------+
  |                   |
  |  Sensor de chuva  |
  |        D7         |
  |                   |
  +--------+----------+
           |
           | Sinal
           |
           V
  +-------------------+
  |                   |
  | Placa de controle |
  |                   |
  +--------+----------+
           | 
           | Sinal
           |
+----------V------------+
|                       |
|        ESP8266        |
|                       |
|                       |
| +---------+           |
| |  Servo  |  +-----+  |
| |  motor  |  | IoT |  |
| |   D5    |  |Cloud|  |
| +---------+  +-----+  |
+-----------------------+
```
